CREATE TABLE STATS (
	STAT_ID INT(11) AUTO_INCREMENT PRIMARY KEY,
	STAT_DATE DATETIME NOT NULL,
	STAT VARCHAR(20) NOT NULL,
	VALUE INT(11) NOT NULL
    );

CREATE VIEW BESTSELLER_COUNT AS
	SELECT COUNT(*) FROM BOOKS
	WHERE BESTSELLER = TRUE;

DELIMITER $$

CREATE EVENT UPDATE_BESTS
	ON SCHEDULE EVERY 1 MINUTE
    DO 	
    BEGIN
		DECLARE CNT INT(4);
		SELECT * FROM BESTSELLER_COUNT
        INTO CNT;
		CALL UpdateBestseller();
		INSERT INTO STATS(STAT_DATE, STAT, VALUE)
			VALUES(CURDATE(), 'BESTSELLERS', CNT);
	END $$
    
    DELIMITER ;
    
    SELECT * FROM STATS;